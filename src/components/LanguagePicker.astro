---
import { languages } from '../i18n/ui'
import { getLangFromUrl, useTranslatedPath } from '../i18n/utils'

const currentLang = getLangFromUrl(Astro.url)
const currentPath = Astro.url.pathname.replace(/^\/(en|ko|ja)/, '') || '/'
---

<div class='language-picker'>
	<select
		id='language-select'
		class='language-select'
		aria-label='Select language'
		data-current-path={currentPath}
	>
		{
			Object.entries(languages).map(([lang, label]) => {
				const translatePath = useTranslatedPath(lang)
				const translatedUrl = translatePath(currentPath, lang)
				return (
					<option value={translatedUrl} selected={lang === currentLang}>
						{label}
					</option>
				)
			})
		}
	</select>
</div>

<script>
	const select = document.getElementById('language-select') as HTMLSelectElement
	if (select) {
		select.addEventListener('change', (e) => {
			const target = e.target as HTMLSelectElement
			window.location.href = target.value
		})
	}
</script>

<style>
	.language-picker {
		position: relative;
		display: inline-block;
	}

	.language-select {
		appearance: none;
		background-color: var(--theme-bg);
		border: 1px solid var(--theme-divider);
		border-radius: 0.375rem;
		color: var(--theme-text);
		cursor: pointer;
		font-size: 0.875rem;
		line-height: 1.25rem;
		padding: 0.5rem 2rem 0.5rem 0.75rem;
		transition: all 0.2s;
		background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
		background-position: right 0.5rem center;
		background-repeat: no-repeat;
		background-size: 1.5em 1.5em;
	}

	.language-select:hover {
		border-color: var(--theme-accent);
	}

	.language-select:focus {
		outline: 2px solid var(--theme-accent);
		outline-offset: 2px;
	}

	@media (prefers-color-scheme: dark) {
		.language-select {
			background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
		}
	}
</style>
