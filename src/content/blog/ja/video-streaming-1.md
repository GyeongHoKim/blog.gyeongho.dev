---
title: 'ブラウザでHEVC映像をストリーミングする #1'
description: '問題状況の認識と解決策の探索'
pubDate: 'May 05 2025'
heroImage: '../../../assets/images/streaming.jpg'
category: 'Frontend'
tags: ['video']
lang: 'ja'
---

ブラウザがサポートするコーデックとブラウザAPIを活用する開発者であれば、戻るボタンを押してください。残念ながら、あなたにとって役立つ内容はありません。

## Overview

私たちの会社は録画機メーカーであり、私が所属するチームはWindows desktop application & Windows serviceを開発します。分野が異なるため、ウェブに興味のある人は残念ながらあまりいません。したがって、ウェブで映像をストリーミングする方法はありませんでした。私の任務は、ウェブ上でビデオストリーミングを実装することでした。

結論：C++ & Emscriptenで作成したウェブアセンブリデコーダー、Goで作成したメディアサーバー、Streaming APIとWeb Workerを使用するVideo/Canvas Video Playerライブラリを作成し、現在はClearKey DRMをサポートするために検討中です。

## 私たちの会社がサポートするプロトコルとコーデック

私たちの映像は次のプロトコルで受信できます。

1. 自社プロトコル
2. RTP

コーデックは以下の通りです。

1. HEVC（主流）
2. AVC

## ブラウザがサポートするプロトコルとコーデック

ブラウザがサポートするプロトコルは以下の通りです。

1. RTP（ソリューションはWebRTCのみですが、非常に多くのビデオ会議ソリューション会社が使用しており、トラフィックが少ない場合に限定して既に業界で検証された方式）
2. HTTP/1とHTTP/2（HLS、DASHなど多くのソリューションが存在し、有名なVOD & Streamingサービス会社が使用しており、ABRも可能。既に業界で検証された方式）
3. WebSocket（中国のセキュリティサービス会社が主に使用、中国限定で検証された方式）
4. HTTP/3（MOQTがFacebook主導で標準提案されましたが、まだ正式に受け入れられていません）

コーデックはベンダーごとに異なります。

ブラウザは許可されたコーデックのみをデコードでき、許可されるコーデックリストはベンダーごとに異なります。私たちのアプリケーションはChromiumを使用しており、Chromiumは私たちが送信するHEVC映像をデコードできません（ライセンス問題）。

## 解決方法

ブラウザが解釈できる形式で映像を提供する必要があります。方法は2つです。

1. トランスコーディング：ブラウザが解釈できるコーデックに変換し、その後ビジネス事例で検証されたプロトコルで配信
2. ブラウザサイドデコーディング：ブラウザが受信できるプロトコルで受信し、その後ブラウザに解釈させずに自分で直接解釈

## トランスコーディング

長所：

1. ブラウザのサポートを受けることができ、映像暗号化（DRM）が可能です。
2. 他の会社と協業する際に便利です。

短所：

1. コンピューティングリソースを多く消費します。
2. 遅延が発生します。
3. サーバーが増えます。

## 余談：映像暗号化は長所か？

https、wssを使用したので暗号化したのではないか？いいえ。それはパケットを暗号化したものであり、映像自体を暗号化しなければ、ダウンロードおよび漏洩方法はいくらでもあります（少なくとも私はできます）。

映像を扱うフロントエンド開発者であれば知っているでしょうが（そして知られたくないでしょうが）、映像漏洩が**売上に**直接的な打撃を受ける会社でなければ、通常DRMを使用しません（もちろん、場合によっては技術的に不可能なケースもあります）。

さらに、非常に敏感な映像を扱う成人向けコンテンツ会社（驚くべきことに、世界売上1位の会社を含む）、国内の交通公社、警察署のウェブページでストリーミングする映像はDRMを使用しません。私が直接映像漏洩が可能か再現して確認しました。

なぜでしょうか？よく考えてみましたが、他のことは分からなくても、確実なのは映像暗号化を長所として受け入れるのはコンテンツプロバイダー（映像をアップロードする人）だけだということです。調査してみると、私の推論を証明する有力な証拠もありました。DRMを要求する主体は通常映画会社...

> 上記の事例 & 私の個人的経験から見て、コンテンツプロバイダーでなければ映像暗号化を長所として考えません。

## 直接デコーディング

長所：

1. コンピューティングリソースを消費しません。
2. トランスコーディングによる遅延が消えます。

短所：

0. **非標準です**。
1. ブラウザAPIはエンコードされた映像を受け取るように設計されています。
2. DRM不可能。
3. 他の会社との協業のたびに苦痛
4. VOD実装が困難（ブラウザサポートなしで直接実装）

## 結論

ブラウザサイドデコーディングを実装します。
私たちは今、RTSPの世界に行きます。しっかりと掴まってください。

次編に続く
